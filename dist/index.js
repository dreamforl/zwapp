!function(e,t){e&&!e.getElementById("livereloadscript")&&((t=e.createElement("script")).async=1,t.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",t.id="livereloadscript",e.getElementsByTagName("head")[0].appendChild(t))}(self.document),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).zwapp=t()}(this,(function(){"use strict";function e(e,t,...n){let i=`zwapp expression Error: ${e}${t?"\n\nexpression:"+t:""}`,o=[];throw n.forEach((e=>{e instanceof HTMLElement?(o.push("\n\nError-Element"),o.push(e)):i+="\n\n"+e})),console.warn(i,...o),new Error(i)}function t(t,n){try{return new Function(`return ${t}`)(t)}catch(i){e(i.message,t,n)}}function n(t,n={},i={},o){try{return new Function(["namespace",...Object.keys(i)],`let result;with(namespace){result = ${t}  } return result `)(n,...Object.values(i))}catch(n){e(n.message,t,o)}}function i(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}class o{#e;constructor(){this.#e={}}change(e,t){this.#e[e]instanceof Array&&this.#e[e].forEach((e=>{e(t)}))}add(e,t){this.#e[e]instanceof Array?this.#e[e].push(t):this.#e[e]=[t]}}const s=/^z-(on|bind|show|if|model|text|for)/;const r=/^z-(on|bind|show|if|model|text|for)/;function c(n){document.querySelectorAll("[z-data]").forEach((async(s,r)=>{let c,d=s.getAttribute("z-data");d=d.replace(/\s/g,""),c=/\(.*?\)/.test(d)?t(d,s):t(d+"()",s);let l=function(t){let n=i(t);"object"!==n&&e("初始化函数应该返回一个对象，当前返回的是"+n);let{data:o,methods:s,watch:r,created:c,mounted:a,computed:d}=t,l={this:{$refs:{}},watch:{},computed:{},ifId:0};if(o){"function"!==i(o)&&e("data需要是一个函数");let t=o(),n=i(t);"object"!==n&&e("data函数返回一个对象.当前返回的是:"+n),l.data=t,Object.entries(t).forEach((e=>{l.this[e[0]]=e[1]}))}if(s){"object"!==i(s)&&e("methods需要是一个对象，内部的变量都是函数"),l.methods=s;let t=Object.keys(l.this);Object.entries(s).forEach((n=>{t.includes(n[0])&&e("methods中与data出现了重名字段:"+n[0]);let o=i(n[1]);"function"!==o&&"asyncfunction"!==o&&e(`methods中的只能包含函数,而${n[0]}是:${o}`),l.this[n[0]]=n[1]}))}if(c&&("function"!=typeof c&&e("created需要是一个函数，当前的是："+item_type),l.created=c),r&&("object"!==i(r)&&e("watch需要是一个对象，内部的变量都是函数"),Object.entries(r).forEach((t=>{"function"!=typeof item_type&&e("watch内部需要是函数"),l.watch[t[0]]=t[1]}))),a&&("function"!=typeof a&&e("mounted需要是一个函数，返回的是一个："+item_type),l.mounted=a),d){let t,n;!l.data||(t=Object.keys(l.data)),!l.methods||(n=Object.keys(l.methods));let o=i(d);"object"!==o&&e("computed需要是一个对象，内部的变量都是函数,当前的是："+o),Object.entries(d).forEach((o=>{let s=i(o[1]);console.log(s),console.log(o),"function"!==s&&"asyncfunction"!==s&&e("computed内部需要是函数,当前的是："+s),/return/.test(o[1].toString())||e("computed内部的函数需要有返回值"),t.includes(o[0])&&e("computed中的方法名，与data中不能一样,:"+o[0]),n.includes(o[0])&&e("computed中的方法名，与methods中不能一样,:"+o[0]),l.computed[o[0]]=o[1].bind(l.this),l.this[o[0]]=l.computed[o[0]]()}))}return delete l.data,delete l.methods,l}(c),{created:u}=l;u&&await u.call(l.this),l.name=`zw-component-${r}`,s.$depend=new o,l.this.$el=s;let f=new Proxy(l.this,{set:(e,t,n)=>(s.$depend.change(t,n),Reflect.set(e,t,n))});!function(e,t){let n=e.querySelectorAll("[ref]");for(let e=0;e<n.length;e++){let i=n[e].getAttribute("ref");t.this.$refs[i]?warn("重复ref"+n[e],t.this.$refs[i]):t.this.$refs[i]=n[e]}}(s,l),l.this=f,s.setAttribute(l.name,""),n.set(l.name,f),a(l,s)}))}function a(e,t){if(!t)return;!function(e,t){t.setAttribute(e.name,""),function(e,t){for(let n=0;n<t.attributes.length;n++){let{name:i,value:o}=t.attributes[n];i=i.replace(/\s{2,}/g," "),o=o.replace(/\s{2,}/g," "),"@"===i[0]&&(i=i.replace(/^@/,"z-on")),":"===i[0]&&(i=i.replace(":","z-bind")),/^z-on:/.test(i)&&(i=i.replace("z-on:","z-on")),/^z-bind:/.test(i)&&(i=i.replace("z-bind:","z-bind")),d.test(i)&&l(i,o,t,e)}}(e,t)}(e,t);let n=t.children.length;if(n>0)for(let i=0;i<n;i++)a(e,t.children[i])}const d=/^z-(on|bind|show|if|model|text|for)/;function l(e,t,i,o){if(/z-on/.test(e))return function(e,t,i,o){e=e.replace(r,"");let s=t.split("(")[0];i.addEventListener(e,(e=>{n(s===t?t+"()":t,o.this,{$event:e},i)}))}(e,t,i,o);if(/z-bind/.test(e))return function(e,t,n,i){e=e.replace(s,"");let o=i.this[t];i.this.$el.$depend.add(t,(e=>{n.setAttribute(t,o)})),n.setAttribute(t,o)}(e,t,i,o);switch(e=e.match(d)[1]){case"show":return function(e,t,n,i){let o=i.this.$el.$depend,s=i.this[t];o.add(t,(e=>{e?n.style.removeProperty("display"):n.style.display="none"})),s?n.style.removeProperty("display"):n.style.display="none"}(0,t,i,o);case"if":return function(e,t,n,i){let o=i.this.$el.$depend,s=i.this[t];o.add(t,(e=>{e?n.style.removeProperty("display"):n.style.display="none"})),s?n.style.removeProperty("display"):n.style.display="none"}(0,t,i,o);case"model":return function(e,t,n,i){n instanceof HTMLInputElement?(n.value=i.this[t],i.this.$el.$depend.add(t,(e=>{n.value=e})),n.addEventListener("input",(e=>{i.this[t]=e.target.value}))):warn("z-model需要绑定在input元素上",n)}(0,t,i,o);case"text":return function(e,t,n,i){let o=i.this.$el.$depend;n.innerText=i.this[t],o.add(t,(e=>{n.innerText=e}))}(0,t,i,o);case"for":return function(e,t,n,i){let o=(t=t.replace(/\s{2,}/g," ").trim()).split(" ");if(3!==o.length||"in"!=o[1])return warn('z-for中请使用正确的语法 类似于 z-for="item in list"',n);if(!(i[o[2]]instanceof Array))return warn("z-for要循环的是数组，请传递数组",n);let s=document.createElement("div"),r=n.innerHTML;i.list.forEach(((e,t)=>{s.innerHTML+=r})),n.innerHTML=s.innerHTML}(0,t,i,o)}}const u={version:"1.0.0",async init(){await new Promise((e=>{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()})),this.namespace=new Map,c(this.namespace)}};return u.init(),u}));
